<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Gesti√≥n de Usuarios</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
        background-color: #EAF6FF;
        padding: 30px;
        margin: 0;
    }

    .card-user {
        border-radius: 15px;
        box-shadow: 0px 5px 15px rgba(0,0,0,0.15);
        transition: .3s;
        padding: 20px;
    }

    .card-user:hover {
        transform: translateY(-7px);
    }

    .btn-action {
        width: 100%;
    }

    /* Contenido principal ajustado para no cortarse con sidebar izquierdo */
    .main-content {
        margin-left: 70px; /* ancho m√≠nimo del sidebar-admin */
        margin-right: 20px;
    }

    /* Sidebar derecho de edici√≥n */
    .sidebar-right {
        position: fixed;
        right: 0;
        top: 0;
        width: 380px;
        height: 100%;
        background: #ffffff;
        box-shadow: -3px 0 15px rgba(0,0,0,0.15);
        padding: 25px;
        transform: translateX(100%);
        transition: 0.4s;
        z-index: 999;
    }

    .sidebar-right.open {
        transform: translateX(0%);
    }

    .sidebar-right h2 {
        margin-top: 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .close-btn {
        cursor: pointer;
        font-size: 24px;
        color: #444;
        font-weight: bold;
    }

    .btn-confirmar {
        width: 100%;
        padding: 10px;
        background: green;
        color: white;
        border: none;
        border-radius: 6px;
        margin-top: 20px;
    }

    .btn-back {
        margin-top: 20px;

    .form-label {
        font-weight: bold;
    }
  </style>
</head>
<body>

<!-- Sidebar izquierdo: se llama desde el fragmento -->
<div th:insert="layout/sidebar-admin :: sidebar"></div>

<!-- Contenido principal -->
<div class="container main-content">

  <h2 class="text-center mb-4">üë• Gesti√≥n de Usuarios</h2>

  <!-- BOT√ìN VOLVER EN EL FONDO -->
  <div class="mb-3">
    <a href="/home/admin" class="btn btn-secondary">‚¨ÖÔ∏è Volver al inicio</a>
  </div>

  <div class="text-end mb-3">
    <a href="/front/usuarios/crear" class="btn btn-primary">‚ûï Crear Usuario</a>
  </div>

  <div class="row g-4">
    <div class="col-md-4" th:each="u : ${usuarios}">
      <div class="card card-user">
        <h4 th:text="${u.nombre + ' ' + u.apellido}"></h4>
        <p><strong>Correo:</strong> <span th:text="${u.correo}"></span></p>
        <p><strong>Rol:</strong> <span th:text="${u.rol}"></span></p>

        <div class="d-grid gap-2 mt-3">
          <a th:href="@{'/front/usuarios/editar/' + ${u.id}}" class="btn btn-info btn-action">‚úèÔ∏è Modificar</a>

          <a th:if="${!u.rol.equalsIgnoreCase('ADMIN')}"
             th:href="@{'/front/usuarios/eliminar/' + ${u.id}}"
             class="btn btn-danger btn-action">‚ùå Eliminar</a>

          <button th:if="${u.rol.equalsIgnoreCase('ADMIN')}"
                  class="btn btn-secondary btn-action" disabled>üîí No se puede eliminar</button>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Sidebar derecho de edici√≥n -->
<div id="sidebar" class="sidebar-right" th:classappend="${usuarioEditar} != null ? ' open' : ''">
  <h2>
    Editar Usuario
    <span class="close-btn" onclick="cerrarSidebar()">√ó</span>
  </h2>

  <form th:action="@{'/front/usuarios/editar/' + ${usuarioEditar.id}}" method="post" th:if="${usuarioEditar}">
    <label class="form-label">Nombre:</label>
    <input type="text" name="nombre" th:value="${usuarioEditar.nombre}" class="form-control mb-3">

    <label class="form-label">Apellido:</label>
    <input type="text" name="apellido" th:value="${usuarioEditar.apellido}" class="form-control mb-3">

    <label class="form-label">Correo:</label>
    <input type="email" name="correo" th:value="${usuarioEditar.correo}" class="form-control mb-3">

    <label class="form-label">Rol:</label>
    <select name="rol" class="form-select mb-3">
      <option th:each="r : ${roles}" th:value="${r}" th:text="${r}" th:selected="${usuarioEditar.rol == r}"></option>
    </select>
    <button class="btn-confirmar" type="submit">‚úÖ Confirmar cambios</button>

  </form>
</div>

<script>
  function cerrarSidebar() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.remove('open');
  }
</script>

</body>
</html>
